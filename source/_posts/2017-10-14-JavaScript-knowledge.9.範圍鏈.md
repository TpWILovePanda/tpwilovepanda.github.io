---
title: 克服JS的奇怪部分-範圍鏈
date: 2017-10-14 00:00:00
tags: [javascript, js]
categories: [javascript]
top:
---
# 範圍鏈
「範圍」代表能取用這變數的地方，而「鏈」是外部環境參照的連結詞彙，這是程式碼被寫出來的物理位置，重點是參考到的是哪的**「外部環境」與「詞彙環境」**，觀察範例-1。
```javascript
// 範例-1
function b() {
  console.log(myVar);
}
function a() {
  var myVar = 2;
  b();
}
var myVar = 1;
a();
// 返回: 1
```
* `b()`函式
  * 詞彙環境: 全域環境之中
  * 外部環境: 全域環境
  * `myVar`詞彙環境: 因為找不到變數，而向外部環境尋找，在全域環境裡面找到`myVar`變數，所以`myVar`詞彙環境在全域環境之中
  * 範圍鏈: `b()` ~ 全域環境
* `a()`函式
  * 詞彙環境: 全域環境之中
  * 外部環境: 全域環境
  * `myVar`詞彙環境: `a()`
  * 範圍鏈: `a()` ~ 全域環境

`b()`詞彙環境是在全域環境，表示`b()`在創造時是與`a()`在同一個全域環境中創造的，所以不是在`a()`裡面，`b()`與第8行`var myVar = 1;`是同一等級。
`b()`的`console.log(myVar);`是 1，這是全域執行環境裡的值，不是`undefined`也不是 2，`b()`執行環境但未宣告`myVar`，所以`b()`執行環境之變數環境中是沒有`myVar`變數。
`a()`在執行時，創造了`a()`的執行環境，並宣告`myVar`是 2，所以`a()`執行環境之變數環境中是有`myVar`變數。。
  
當要使用變數時，JavaScript不只會在目前的執行環境的變數環境中尋找，每個執行環境都有特殊的東西創造，像是變數`this`，也有另一件事情，就是外部環境的參照，每一個執行環境有一個參照到它的外部環境，我們以範例-1的情況思考，`b()`它外部環境是全域執行環境，`a()`也是同樣情況。

```javascript
// 範例-2
function a() {
  var myVar = 2;
  function b() {
    console.log(myVar);
  }
  b();
}
var myVar = 1;
a();
// 返回: 2
```
* `b()`函式
  * 詞彙環境: `a()`之中
  * 外部環境: `a()`
  * `myVar`詞彙環境: 因為找不到變數，而向外部環境尋找，在`a()`裡面找到`myVar`變數，所以`myVar`詞彙環境在`a()`之中
  * 範圍鏈: `b()` ~ `a()` ~ 全域環境'
* `a()`函式
  * 詞彙環境: 全域環境之中
  * 外部環境: 全域環境
  * `myVar`詞彙環境: `a()`
  * 範圍鏈: `a()` ~ 全域環境

## 參考資源 (References)
* [JavaScript 全攻略：克服 JS 的奇怪部分](https://www.udemy.com/javascriptjs/learn/v4/overview)